<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Accessing Google's Petabyte Scale Satellite Data | Sean T. Howard</title> <meta name="author" content="Sean T. Howard"/> <meta name="description" content="Using Google's Earth Engine python library to query Sentinel-2 imagery"/> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light"/> <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŒŒ</text></svg>"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://seanhoward.me/blog/2022/Google_Earth_Engine/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="https://seanhoward.me/"><span class="font-weight-bold">Sean</span> T. Howard</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Accessing Google's Petabyte Scale Satellite Data</h1> <p class="post-meta">September 29, 2022</p> <p class="post-tags"> <a href="/blog/2022"> <i class="fas fa-calendar fa-sm"></i> 2022 </a> Â  Â· Â  <a href="/blog/tag/Remote-Sensing"> <i class="fas fa-hashtag fa-sm"></i> Remote-Sensing</a> Â  <a href="/blog/tag/Data-Science"> <i class="fas fa-hashtag fa-sm"></i> Data-Science</a> Â  Â  Â· Â  <a href="/blog/category/Intros"> <i class="fas fa-tag fa-sm"></i> Intros</a> Â  </p> </header> <article class="post-content"> <h2 id="accessing-satellite-imagery-with-google-earth-engine">Accessing Satellite Imagery with Google Earth Engine</h2> <p><a href="https://colab.research.google.com/github/st-howard/blog-notebooks/blob/main/Google_Earth_Engine/Satellite%20Imagery%20with%20Google%20Earth%20Engine.ipynb" target="_blank" rel="noopener noreferrer"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open in Colab"></a></p> <p>Satellites provide a wealth of information about the world: monitoring human development, tracking climate change, and providing vital information at scale for disaster response. Over the past decades, the scale of publicly accessible satellite data has increased exponentially. This data is collected by many research consortia, often stored on servers and accessible with APIs unique to the mission. <a href="https://earthengine.google.com/" target="_blank" rel="noopener noreferrer">Googleâ€™s Earth Engine</a> hosts a large, multi-petabyte <a href="https://developers.google.com/earth-engine/datasets/" target="_blank" rel="noopener noreferrer">catalog</a> of satellite imagery which can be accessed and queried with a common API, for free with a Google account. This service, which requires the technical knowledge and bankroll of a tech giant, is boon for using satellite imagery at scale to learn more about the world we live in. This post documents basic interaction with the Earth Engine API in python, focusing on how to get Sentinel-2 MSI imagery.</p> <details> <summary>Load python libraries</summary> <div class="language-python highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="c1"># Import Libraries
</span>
<span class="kn">import</span> <span class="n">ee</span>  <span class="c1"># Google Earth Engine
</span><span class="kn">import</span> <span class="n">eemont</span>  <span class="c1"># Extension to Google Earth Engine
</span>
<span class="kn">from</span> <span class="n">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">rasterio</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="n">geopy</span>
<span class="kn">import</span> <span class="n">geopy.distance</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
</code></pre></div> </div> </details> <h3 id="autheticate-google-earth-engine-account">Autheticate Google Earth Engine Account</h3> <p>The first step of using Google Earth Engine (after signing up with a google account) is to authenticate your session, which can be done interactively in a jupyter notebook by running the following commands.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ee</span><span class="p">.</span><span class="nc">Authenticate</span><span class="p">()</span>
<span class="n">ee</span><span class="p">.</span><span class="nc">Initialize</span><span class="p">()</span>
</code></pre></div></div> <h3 id="select-location-to-request-imagery">Select Location to Request Imagery</h3> <p>To query satellite imagery of a particular location on earth, we first need to create a Earth Engine <a href="https://developers.google.com/earth-engine/guides/geometries" target="_blank" rel="noopener noreferrer">Geometry Object</a>. Iâ€™ve found the eeMont python package that extends Google Earth Engine to be helpful in exploratory analysis, since it can return a Geometry Point based on a text query. Below is a query for Washington D.C.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">point</span> <span class="o">=</span> <span class="n">ee</span><span class="p">.</span><span class="n">Geometry</span><span class="p">.</span><span class="nc">PointFromQuery</span><span class="p">(</span><span class="sh">"</span><span class="s">Washington DC</span><span class="sh">"</span><span class="p">,</span> <span class="n">user_agent</span><span class="o">=</span><span class="sh">"</span><span class="s">earth_engine_example</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <p>Which returns a single longitude, latitude pair for Washington D.C., as you would get if the same query was entered into Google Maps.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">print</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ee.Geometry({
  "functionInvocationValue": {
    "functionName": "GeometryConstructors.Point",
    "arguments": {
      "coordinates": {
        "constantValue": [
          -77.0365427,
          38.8950368
        ]
      }
    }
  }
})
</code></pre></div></div> <h3 id="create-bounding-box-helper-function">Create Bounding Box Helper Function</h3> <p>For this example, I want to get a subset of Sentinel-2 Image. In requesting an image, it is necessary to request either the scale (i.e. sampling distance of pixel) of the image or the pixel dimensions of the subset. Sentinel-2 MSI Imagery has a <a href="https://developers.google.com/earth-engine/datasets/catalog/COPERNICUS_S2_SR" target="_blank" rel="noopener noreferrer">10m resolution</a>, however if I request a full image at that resolution it is too large. And if I request a image with a specified pixel dimension, then the image is downsampled to a worse resolution than the native 10m.</p> <p>To get an image subset with roughly native resolution, I created a function that makes a <a href="https://en.wikipedia.org/wiki/Minimum_bounding_box" target="_blank" rel="noopener noreferrer">bounding box</a> of a specified size centered on an initial latitude and longitude point.</p> <details> <summary>Bounding Box helper function</summary> <div class="language-python highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">BBoxFromPoint</span><span class="p">(</span><span class="n">bbox_size</span><span class="p">,</span> <span class="n">lat_point</span><span class="p">,</span> <span class="n">lon_point</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    bbox_size - either square in km (one value) or two values in NS km, then EW km
    lat_point - lat center of bounding box
    lon_point - lon center of bounding box

    returns ee.Geometry object of bounding box
    </span><span class="sh">"""</span>
    <span class="k">if</span> <span class="nf">type</span><span class="p">(</span><span class="n">bbox_size</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nf">type</span><span class="p">(</span><span class="n">bbox_size</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">bbox_size</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="n">bbox_size</span><span class="p">])</span>

    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">bbox_size</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">lat_km</span> <span class="o">=</span> <span class="n">bbox_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">lon_km</span> <span class="o">=</span> <span class="n">bbox_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nf">len</span><span class="p">(</span><span class="n">bbox_size</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">lat_km</span><span class="p">,</span> <span class="n">lon_km</span> <span class="o">=</span> <span class="n">bbox_size</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sh">"</span><span class="s">bbox_size must be either length 1 or 2</span><span class="sh">"</span><span class="p">)</span>

    <span class="n">origin</span> <span class="o">=</span> <span class="n">geopy</span><span class="p">.</span><span class="nc">Point</span><span class="p">(</span><span class="n">lat_point</span><span class="p">,</span> <span class="n">lon_point</span><span class="p">)</span>
    <span class="n">lat_min</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">geopy</span><span class="p">.</span><span class="n">distance</span><span class="p">.</span><span class="nf">geodesic</span><span class="p">(</span><span class="n">kilometers</span><span class="o">=</span><span class="n">lat_km</span> <span class="o">/</span> <span class="mi">2</span><span class="p">).</span><span class="nf">destination</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">bearing</span><span class="o">=</span><span class="mi">180</span><span class="p">)</span>
    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">lat_max</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">geopy</span><span class="p">.</span><span class="n">distance</span><span class="p">.</span><span class="nf">geodesic</span><span class="p">(</span><span class="n">kilometers</span><span class="o">=</span><span class="n">lat_km</span> <span class="o">/</span> <span class="mi">2</span><span class="p">).</span><span class="nf">destination</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">bearing</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">lon_min</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">geopy</span><span class="p">.</span><span class="n">distance</span><span class="p">.</span><span class="nf">geodesic</span><span class="p">(</span><span class="n">kilometers</span><span class="o">=</span><span class="n">lat_km</span> <span class="o">/</span> <span class="mi">2</span><span class="p">).</span><span class="nf">destination</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">bearing</span><span class="o">=</span><span class="mi">270</span><span class="p">)</span>
    <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">lon_max</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">geopy</span><span class="p">.</span><span class="n">distance</span><span class="p">.</span><span class="nf">geodesic</span><span class="p">(</span><span class="n">kilometers</span><span class="o">=</span><span class="n">lat_km</span> <span class="o">/</span> <span class="mi">2</span><span class="p">).</span><span class="nf">destination</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">bearing</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">ee</span><span class="p">.</span><span class="n">Geometry</span><span class="p">.</span><span class="nc">BBox</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lat_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">)</span>
</code></pre></div> </div> </details> <p><br></p> <p>With this information, I created a bounding box of 5.12 km x 5.12 km so that when I ask for a 512 x 512 pixel image it is approximately at the native 10m resolution of Sentinel-2 MSI imagery.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">DC_lon</span><span class="p">,</span> <span class="n">DC_lat</span> <span class="o">=</span> <span class="n">point</span><span class="p">.</span><span class="nf">coordinates</span><span class="p">().</span><span class="nf">getInfo</span><span class="p">()</span>
<span class="n">DC_bbox</span> <span class="o">=</span> <span class="nc">BBoxFromPoint</span><span class="p">(</span><span class="mf">5.12</span><span class="p">,</span> <span class="n">DC_lat</span><span class="p">,</span> <span class="n">DC_lon</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">DC_bbox</span><span class="p">.</span><span class="nf">getInfo</span><span class="p">()</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{'geodesic': False,
 'type': 'Polygon',
 'coordinates': [[[-77.06605134109452, 38.87197649154135],
   [-77.00703405890545, 38.87197649154135],
   [-77.00703405890545, 38.91809701712762],
   [-77.06605134109452, 38.91809701712762],
   [-77.06605134109452, 38.87197649154135]]]}
</code></pre></div></div> <h3 id="get-image-collection-from-google-earth-engine">Get Image Collection From Google Earth Engine</h3> <p>With a location selected, the next step of getting imagery from Google Earth Engine is to specify the dataset. Below this is done by running <code class="language-plaintext highlighter-rouge">ee.ImageCollection("COPERNICUS/S2_SR_HARMONIZED")</code>. Creating the <code class="language-plaintext highlighter-rouge">ImageCollection</code> object does not return the entire dataset (which is a good thing because it is extremely large), but creates a object on the user side which, when prompted by other methods, can make a request of Googleâ€™s server. This is detailed in the <a href="https://developers.google.com/earth-engine/guides/client_server" target="_blank" rel="noopener noreferrer">Client vs. Server</a> section of Googleâ€™s documentation.</p> <p>After creating the ImageCollection object, the data we are interested can be specified with filter functions, in this case <code class="language-plaintext highlighter-rouge">filterBounds</code> for images intersecting the Geometry object, <code class="language-plaintext highlighter-rouge">filterDate</code> for specifying the date range to look for images, and <code class="language-plaintext highlighter-rouge">filter</code> for a generic filter which can query against properties of each image, listed <a href="https://developers.google.com/earth-engine/datasets/catalog/COPERNICUS_S2_SR" target="_blank" rel="noopener noreferrer">here</a> for Sentinel-2. The last <code class="language-plaintext highlighter-rouge">filter</code> selects images with 5% or less cloudy pixels.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">DC_collection</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ee</span><span class="p">.</span><span class="nc">ImageCollection</span><span class="p">(</span><span class="sh">"</span><span class="s">COPERNICUS/S2_SR_HARMONIZED</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">filterBounds</span><span class="p">(</span><span class="n">DC_bbox</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">filterDate</span><span class="p">(</span><span class="sh">"</span><span class="s">2020-01-01</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">2021-01-01</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">ee</span><span class="p">.</span><span class="n">Filter</span><span class="p">.</span><span class="nf">lte</span><span class="p">(</span><span class="sh">"</span><span class="s">CLOUDY_PIXEL_PERCENTAGE</span><span class="sh">"</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="p">)</span>
</code></pre></div></div> <p>In the above image collection, multiple images will satisfy the geospatial, temporal, and cloud percentage requirements. Therefore, it is necessary to select a single image from the set of qualifying images. A simple way to do that is with the <code class="language-plaintext highlighter-rouge">first</code> method, which can be passed into the <code class="language-plaintext highlighter-rouge">ee.Image</code> constructor to make an image object.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">DC_image</span> <span class="o">=</span> <span class="n">ee</span><span class="p">.</span><span class="nc">Image</span><span class="p">(</span><span class="n">DC_collection</span><span class="p">.</span><span class="nf">first</span><span class="p">())</span>
</code></pre></div></div> <p>To grab the metadata associated with this image, we need to call the <code class="language-plaintext highlighter-rouge">getInfo</code> method on the Image object. This is because the Image object exists on the Client side and has not yet made a request to Googleâ€™s servers.</p> <details> <summary>Investigate details of Image metadata</summary> <div class="language-python highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="n">DC_Image_info</span> <span class="o">=</span> <span class="n">DC_image</span><span class="p">.</span><span class="nf">getInfo</span><span class="p">()</span>
</code></pre></div> </div> <p>The metadata of the image is returned as a python dictionary and contains a variety of metadata associated with the image, including the acquisition date.</p> <div class="language-python highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Image Info is a </span><span class="sh">"</span><span class="p">,</span> <span class="nf">type</span><span class="p">(</span><span class="n">DC_Image_info</span><span class="p">))</span>
</code></pre></div> </div> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>Image Info is a  &lt;class 'dict'&gt;
</code></pre></div> </div> <div class="language-python highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Fields of Image Info:</span><span class="sh">"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">DC_Image_info</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</code></pre></div> </div> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>Fields of Image Info:
type
bands
version
id
properties
</code></pre></div> </div> <div class="language-python highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Start time of Image:</span><span class="se">\t</span><span class="sh">"</span><span class="p">,</span> <span class="n">DC_Image_info</span><span class="p">[</span><span class="sh">"</span><span class="s">properties</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">system:time_start</span><span class="sh">"</span><span class="p">])</span>

<span class="nf">print</span><span class="p">(</span>
    <span class="sh">"</span><span class="s">Date:</span><span class="se">\t\t\t</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="nf">fromtimestamp</span><span class="p">(</span>
        <span class="n">DC_Image_info</span><span class="p">[</span><span class="sh">"</span><span class="s">properties</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">system:time_start</span><span class="sh">"</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="p">).</span><span class="nf">strftime</span><span class="p">(</span><span class="sh">"</span><span class="s">%c</span><span class="sh">"</span><span class="p">),</span>
<span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Sentinel ID:</span><span class="se">\t\t</span><span class="sh">"</span><span class="p">,</span> <span class="n">DC_Image_info</span><span class="p">[</span><span class="sh">"</span><span class="s">properties</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">DATATAKE_IDENTIFIER</span><span class="sh">"</span><span class="p">])</span>
</code></pre></div> </div> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>Start time of Image:	 1579190537887
Date:			 Thu Jan 16 11:02:17 2020
Sentinel ID:		 GS2B_20200116T155609_014952_N02.13
</code></pre></div> </div> </details> <p><br></p> <p>To get the actual image from Googleâ€™s servers, you need to call either <code class="language-plaintext highlighter-rouge">getThumbURL</code> or <code class="language-plaintext highlighter-rouge">getDownloadURL</code>. <code class="language-plaintext highlighter-rouge">getThumbURL</code> will generate a url with the image in the requested format. This function <strong>requires</strong> a dictionary specifying the parameters necessary to generate the image. For instance, Sentinel-2 data has over 10 bands and which band should be mapped to Red, Green, and Blue is ambiguous. Below the bands B4, B3, B2 are mapped red, green, and blue respectively. For multispectral imagery (MSI) these bands correspond to their mapped colors, but for other formats of imagery such as those beyond the visible must be assigned to artificial colors.</p> <p>In addition to specifying the bands, the pixel dimensions of the image, and the bounding box of the image, the data range of the image needs to be specified. According to the data description on the Google Earth Engine website, the data value of the band is the surface reflectance multiplied by 10,000. Iâ€™ve found decent results by setting the data range from $[0,4000]$, or a surface reflectance from 0% to 40%.</p> <p>The url can be read into a PIL image by using the <code class="language-plaintext highlighter-rouge">requests</code> module and passing the raw response into <code class="language-plaintext highlighter-rouge">PIL.Image.open()</code>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">DC_url</span> <span class="o">=</span> <span class="n">DC_image</span><span class="p">.</span><span class="nf">getThumbURL</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="sh">"</span><span class="s">format</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">png</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">bands</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">B4</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">B3</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">B2</span><span class="sh">"</span><span class="p">],</span>
        <span class="sh">"</span><span class="s">dimensions</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">],</span>
        <span class="sh">"</span><span class="s">region</span><span class="sh">"</span><span class="p">:</span> <span class="n">DC_bbox</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">min</span><span class="sh">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">max</span><span class="sh">"</span><span class="p">:</span> <span class="mi">4000</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">DC_thumbURL_response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">DC_url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">DC_PIL</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="n">DC_thumbURL_response</span><span class="p">.</span><span class="n">raw</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">DC_PIL</span>
</code></pre></div></div> <figure> <img src="/assets/img/blogs/Google_Earth_Engine/gee_0.png" width="60%"> </figure> <p>Since the data is in a PIL Image, it can be saved easily with the <code class="language-plaintext highlighter-rouge">.save</code> method.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">DC_PIL</span><span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="sh">"</span><span class="s">Sentinel-2_DC.png</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <h3 id="download-image-as-a-geotiff">Download Image as a GeoTiff</h3> <p>The thumbnails from <code class="language-plaintext highlighter-rouge">getThumbURL</code> are meant to be visualized and therefore require either one band (grayscale) or three bands (RGB). However, to get the full data from all or a selection of the bands collected you need to download the GeoTiff with <code class="language-plaintext highlighter-rouge">getDownloadURL</code>. The format is very similar to the <code class="language-plaintext highlighter-rouge">getThumbURL</code> method as it requires a dictionary specifying parameters of image. Instead of generating a png, the download url is a zip file which unzips into a GeoTiff.</p> <p>The code below generates the download url, downloads the image, uzips it, loads it with rasterio, and plots the image (same as above) and the histogram of the reflectance values</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">DC_downloadURL</span> <span class="o">=</span> <span class="n">DC_image</span><span class="p">.</span><span class="nf">getDownloadURL</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="sh">"</span><span class="s">bands</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">B2</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">B3</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">B4</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">B8</span><span class="sh">"</span><span class="p">],</span>
        <span class="sh">"</span><span class="s">dimensions</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">],</span>
        <span class="sh">"</span><span class="s">region</span><span class="sh">"</span><span class="p">:</span> <span class="n">DC_bbox</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">filePerBand</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div> <details> <summary>Download Image as Tiff and Plot Image</summary> <div class="language-python highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="n">DC_download_response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">DC_downloadURL</span><span class="p">)</span>
</code></pre></div> </div> <div class="language-python highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">DC_geotiff.zip</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">wb</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
    <span class="n">fd</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">DC_download_response</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>
</code></pre></div> </div> <div class="language-python highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">zipfile</span>

<span class="k">with</span> <span class="n">zipfile</span><span class="p">.</span><span class="nc">ZipFile</span><span class="p">(</span><span class="sh">"</span><span class="s">DC_geotiff.zip</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">r</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
    <span class="n">zip_ref</span><span class="p">.</span><span class="nf">extractall</span><span class="p">()</span>
</code></pre></div> </div> <div class="language-python highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">glob</span>

<span class="n">fname</span> <span class="o">=</span> <span class="n">glob</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="sh">"</span><span class="s">*.tif</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div> </div> <div class="language-python highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="n">DC_dataset</span> <span class="o">=</span> <span class="n">rasterio</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="n">fname</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div> </div> <div class="language-python highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Image heigt, width:</span><span class="sh">"</span><span class="p">,</span> <span class="n">DC_dataset</span><span class="p">.</span><span class="n">height</span><span class="p">,</span> <span class="sh">"</span><span class="s">,</span><span class="sh">"</span><span class="p">,</span> <span class="n">DC_dataset</span><span class="p">.</span><span class="n">width</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Number Bands:</span><span class="sh">"</span><span class="p">,</span> <span class="n">DC_dataset</span><span class="p">.</span><span class="n">count</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Datatype:</span><span class="sh">"</span><span class="p">,</span> <span class="n">DC_dataset</span><span class="p">.</span><span class="n">dtypes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div> </div> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>Image heigt, width: 512 , 512
Number Bands: 4
Datatype: uint16
</code></pre></div> </div> <div class="language-python highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="n">DC_raster</span> <span class="o">=</span> <span class="n">DC_dataset</span><span class="p">.</span><span class="nf">read</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</code></pre></div> </div> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>Warning 1: TIFFReadDirectory:Sum of Photometric type-related color channels and ExtraSamples doesn't match SamplesPerPixel. Defining non-color channels as ExtraSamples.
</code></pre></div> </div> <div class="language-python highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">moveaxis</span><span class="p">(</span><span class="n">DC_raster</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="nf">percentile</span><span class="p">(</span><span class="n">DC_raster</span><span class="p">,</span> <span class="mi">99</span><span class="p">))</span>
</code></pre></div> </div> </details> <p><br></p> <figure> <img src="/assets/img/blogs/Google_Earth_Engine/gee_1.png" width="60%"> <figcaption> GeoTiff image plotted with rasterio </figcaption> </figure> <p>And with the full range of the bands, which are processed to be in units of surface reflectance multiplied by 10,000, the histogram of the selected bands can be plotted. Notably, the GeoTiff bands have a much larger dynamic range (16-bit) versus the png image returned from <code class="language-plaintext highlighter-rouge">getThumbUrL</code> (8-bit).</p> <details> <summary>Plot histogram of B2, B3, B4, B8</summary> <div class="language-python highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="c1"># Red band
</span><span class="n">plt</span><span class="p">.</span><span class="nf">hist</span><span class="p">(</span>
    <span class="p">(</span><span class="n">DC_dataset</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="nf">flatten</span><span class="p">())</span> <span class="o">/</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">"</span><span class="s">red</span><span class="sh">"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">"</span><span class="s">B4-Red</span><span class="sh">"</span>
<span class="p">)</span>

<span class="c1"># Blue band
</span><span class="n">plt</span><span class="p">.</span><span class="nf">hist</span><span class="p">(</span>
    <span class="p">(</span><span class="n">DC_dataset</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nf">flatten</span><span class="p">())</span> <span class="o">/</span> <span class="mi">10000</span><span class="p">,</span>
    <span class="mi">200</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="sh">"</span><span class="s">green</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sh">"</span><span class="s">B3-Green</span><span class="sh">"</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Green band
</span><span class="n">plt</span><span class="p">.</span><span class="nf">hist</span><span class="p">(</span>
    <span class="p">(</span><span class="n">DC_dataset</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">flatten</span><span class="p">())</span> <span class="o">/</span> <span class="mi">10000</span><span class="p">,</span>
    <span class="mi">200</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="sh">"</span><span class="s">blue</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sh">"</span><span class="s">B2-Blue</span><span class="sh">"</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># NIR band
</span><span class="n">plt</span><span class="p">.</span><span class="nf">hist</span><span class="p">(</span>
    <span class="p">(</span><span class="n">DC_dataset</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="nf">flatten</span><span class="p">())</span> <span class="o">/</span> <span class="mi">10000</span><span class="p">,</span>
    <span class="mi">200</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="sh">"</span><span class="s">black</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sh">"</span><span class="s">B8-NIR</span><span class="sh">"</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">xscale</span><span class="p">(</span><span class="sh">"</span><span class="s">log</span><span class="sh">"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Surface Reflectance</span><span class="sh">"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">"</span><span class="s">Surface Reflectance Values for D.C. Sentinel-2 Image</span><span class="sh">"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div> </div> </details> <p><br></p> <figure> <img src="/assets/img/blogs/Google_Earth_Engine/gee_2.png" width="60%"> <figcaption> GeoTiff image plotted with rasterio </figcaption> </figure> <h3 id="generate-timelapse-video">Generate timelapse video</h3> <p>As an example of the power and flexibility of Google Earth Engine, here is a quick script to save frames for a timelapse video of the construction of <a href="https://en.wikipedia.org/wiki/Fiery_Cross_Reef" target="_blank" rel="noopener noreferrer">Fiery Cross Reef</a>, a coral reef in the South China Sea which was <a href="https://www.cnbc.com/2017/06/30/china-builds-military-facilities-south-china-sea-islands.html" target="_blank" rel="noopener noreferrer">terraformed by China into a naval base</a> from 2013 to 2017.</p> <details> <summary>Generate movie of Fiery Cross Reef construciton</summary> <div class="language-python highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="n">fcr_bbox</span> <span class="o">=</span> <span class="nc">BBoxFromPoint</span><span class="p">(</span><span class="mf">0.03</span> <span class="o">*</span> <span class="mi">256</span><span class="p">,</span> <span class="mf">9.549167</span><span class="p">,</span> <span class="mf">112.889167</span><span class="p">)</span>
</code></pre></div> </div> <div class="language-python highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="n">fcr_collection</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ee</span><span class="p">.</span><span class="nc">ImageCollection</span><span class="p">(</span><span class="sh">"</span><span class="s">LANDSAT/LC08/C02/T1_L2</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">filterBounds</span><span class="p">(</span><span class="n">fcr_bbox</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">filterDate</span><span class="p">(</span><span class="sh">"</span><span class="s">2013-04-01</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">2018-06-01</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">ee</span><span class="p">.</span><span class="n">Filter</span><span class="p">.</span><span class="nf">lte</span><span class="p">(</span><span class="sh">"</span><span class="s">CLOUD_COVER</span><span class="sh">"</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
<span class="p">)</span>
</code></pre></div> </div> <div class="language-python highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="c1"># test the example image
</span>
<span class="n">fcr_first_image</span> <span class="o">=</span> <span class="n">ee</span><span class="p">.</span><span class="nc">Image</span><span class="p">(</span><span class="n">fcr_collection</span><span class="p">.</span><span class="nf">first</span><span class="p">())</span>

<span class="n">fcr_url</span> <span class="o">=</span> <span class="n">fcr_first_image</span><span class="p">.</span><span class="nf">getThumbURL</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="sh">"</span><span class="s">format</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">png</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">bands</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">SR_B4</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">SR_B3</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">SR_B2</span><span class="sh">"</span><span class="p">],</span>
        <span class="sh">"</span><span class="s">dimensions</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">],</span>
        <span class="sh">"</span><span class="s">region</span><span class="sh">"</span><span class="p">:</span> <span class="n">fcr_bbox</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">min</span><span class="sh">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">max</span><span class="sh">"</span><span class="p">:</span> <span class="mi">29000</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">fcr_first_response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">fcr_url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">fcr_PIL</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="n">fcr_first_response</span><span class="p">.</span><span class="n">raw</span><span class="p">)</span>

<span class="n">fcr_PIL</span>
</code></pre></div> </div> <figure> <img src="/assets/img/blogs/Google_Earth_Engine/gee_3.png" width="60%"> <figcaption> Fiery Cross Reef before terraforming </figcaption> </figure> <div class="language-python highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="c1"># Loop through the images and save them
</span>
<span class="n">number_of_images</span> <span class="o">=</span> <span class="n">fcr_collection</span><span class="p">.</span><span class="nf">size</span><span class="p">().</span><span class="nf">getInfo</span><span class="p">()</span>
<span class="n">fcr_list</span> <span class="o">=</span> <span class="n">fcr_collection</span><span class="p">.</span><span class="nf">toList</span><span class="p">(</span><span class="n">fcr_collection</span><span class="p">.</span><span class="nf">size</span><span class="p">())</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">number_of_images</span><span class="p">):</span>
    <span class="n">fcr_image</span> <span class="o">=</span> <span class="n">ee</span><span class="p">.</span><span class="nc">Image</span><span class="p">(</span><span class="n">fcr_list</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

    <span class="n">fcr_url</span> <span class="o">=</span> <span class="n">fcr_image</span><span class="p">.</span><span class="nf">getThumbURL</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="sh">"</span><span class="s">format</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">png</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">bands</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">SR_B4</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">SR_B3</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">SR_B2</span><span class="sh">"</span><span class="p">],</span>
            <span class="sh">"</span><span class="s">dimensions</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">],</span>
            <span class="sh">"</span><span class="s">region</span><span class="sh">"</span><span class="p">:</span> <span class="n">fcr_bbox</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">min</span><span class="sh">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">max</span><span class="sh">"</span><span class="p">:</span> <span class="mi">30000</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="n">fcr_response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">fcr_url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">fcr_PIL</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="n">fcr_response</span><span class="p">.</span><span class="n">raw</span><span class="p">)</span>

    <span class="n">fcr_PIL</span><span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">fcr_images/fcr_</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="mi">03</span><span class="si">}</span><span class="s">.png</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div> </div> <p>With the images are combined into mp4 using <a href="https://en.wikipedia.org/wiki/FFmpeg" target="_blank" rel="noopener noreferrer">ffmpeg</a>.</p> </details> <p><br></p> <figure> <video width="480" height="360" controls=""> <source src="/assets/img/blogs/Google_Earth_Engine/fiery_cross_reef_timelapse.mp4" type="video/mp4"></source> </video> <figcaption>Timelapse of Fiery Cross Reef Terraforming</figcaption> </figure> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> Â© Copyright 2023 Sean T. Howard. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer">al-folio</a> theme. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> </body> </html>